<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Kanban 简化测试</title>
    <script src="/static/vendor/alpine.min.js" defer></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        input, button { padding: 10px; margin: 5px; }
        .task { border: 1px solid #ddd; padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Kanban 简化测试</h1>
    
    <div x-data="simpleKanban()">
        <div>
            <input type="text" x-model="newTask" placeholder="任务描述">
            <button @click="createTask()">创建任务</button>
        </div>
        
        <p>当前输入: <strong x-text="newTask"></strong></p>
        <p>Loading: <strong x-text="loading"></strong></p>
        <p x-show="error" style="color: red;" x-text="error"></p>
        
        <h2>Inbox (<span x-text="tasks.length"></span>)</h2>
        <template x-for="task in tasks" :key="task.id">
            <div class="task" x-text="task.description"></div>
        </template>
    </div>
    
    <script>
        function simpleKanban() {
            console.log('simpleKanban() 初始化');
            return {
                newTask: '',
                loading: false,
                error: '',
                tasks: [],
                
                async createTask() {
                    console.log('createTask 被调用, newTask=', this.newTask);
                    
                    if (!this.newTask.trim()) {
                        alert('请输入任务描述');
                        return;
                    }
                    
                    this.loading = true;
                    this.error = '';
                    
                    try {
                        const res = await fetch('/api/kanban/tasks', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                description: this.newTask,
                                priority: 'P2'
                            })
                        });
                        
                        if (!res.ok) throw new Error('创建失败');
                        
                        const data = await res.json();
                        console.log('任务创建成功:', data);
                        this.tasks.push(data);
                        this.newTask = '';
                        alert('任务创建成功: ' + data.id);
                    } catch (e) {
                        console.error('错误:', e);
                        this.error = e.message;
                        alert('错误: ' + e.message);
                    } finally {
                        this.loading = false;
                    }
                }
            };
        }
    </script>
</body>
</html>
