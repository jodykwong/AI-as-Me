<!DOCTYPE html>
<html>
<head>
    <script src="/static/vendor/alpine.min.js" defer></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Alpine.js + API é›†æˆæµ‹è¯•</h1>
    
    <div x-data="testApp()">
        <h2>æµ‹è¯• 1: Alpine.js åŸºç¡€åŠŸèƒ½</h2>
        <button @click="count++">ç‚¹å‡»è®¡æ•°: <span x-text="count"></span></button>
        <p x-show="count > 0" class="success">âœ“ Alpine.js æ­£å¸¸å·¥ä½œ</p>
        
        <hr>
        
        <h2>æµ‹è¯• 2: åˆ›å»ºä»»åŠ¡ API</h2>
        <input type="text" x-model="taskDesc" placeholder="ä»»åŠ¡æè¿°" style="padding: 8px; width: 300px;">
        <button @click="createTask()" :disabled="loading">
            <span x-text="loading ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºä»»åŠ¡'"></span>
        </button>
        
        <div x-show="result" style="margin-top: 10px;">
            <p x-show="result?.success" class="success" x-text="'âœ“ ä»»åŠ¡åˆ›å»ºæˆåŠŸ: ' + result?.id"></p>
            <p x-show="result?.error" class="error" x-text="'âœ— é”™è¯¯: ' + result?.error"></p>
        </div>
        
        <hr>
        
        <h2>æµ‹è¯• 3: åŠ è½½çœ‹æ¿</h2>
        <button @click="loadBoard()">åŠ è½½çœ‹æ¿</button>
        <div x-show="board" style="margin-top: 10px;">
            <p class="success">âœ“ çœ‹æ¿åŠ è½½æˆåŠŸ</p>
            <pre x-text="JSON.stringify(board, null, 2)" style="background: #f5f5f5; padding: 10px;"></pre>
        </div>
    </div>
    
    <script>
        function testApp() {
            return {
                count: 0,
                taskDesc: 'E2Eé›†æˆæµ‹è¯•ä»»åŠ¡',
                loading: false,
                result: null,
                board: null,
                
                async createTask() {
                    console.log('createTask called');
                    this.loading = true;
                    this.result = null;
                    
                    try {
                        const res = await fetch('/api/kanban/tasks', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                description: this.taskDesc,
                                priority: 'P2'
                            })
                        });
                        
                        if (!res.ok) {
                            const data = await res.json();
                            throw new Error(data.detail || 'åˆ›å»ºå¤±è´¥');
                        }
                        
                        const data = await res.json();
                        this.result = { success: true, id: data.id };
                        console.log('Task created:', data);
                    } catch (e) {
                        this.result = { error: e.message };
                        console.error('Error:', e);
                    } finally {
                        this.loading = false;
                    }
                },
                
                async loadBoard() {
                    try {
                        const res = await fetch('/api/kanban/board');
                        this.board = await res.json();
                        console.log('Board loaded:', this.board);
                    } catch (e) {
                        console.error('Load board error:', e);
                    }
                }
            }
        }
    </script>
</body>
</html>
