---
stepsCompleted: ["step-01-init", "step-02-discovery", "step-03-success", "step-04-journeys", "step-05-domain", "step-06-innovation", "step-07-project-type", "step-08-scoping", "step-09-functional", "step-10-nonfunctional", "step-11-polish", "step-12-complete"]
inputDocuments:
  - "product-brief-AI-as-Me-2026-01-13.md"
  - "v2.0_iteration_plan.md"
  - "v2.0_workflows.md"
  - "architecture.md"
  - "project-context.md"
documentCounts:
  briefs: 1
  research: 0
  projectDocs: 4
  projectContext: 1
workflowType: 'prd'
status: 'complete'
completedAt: '2026-01-13T05:20:49+08:00'
finalDocument: 'prd-v2.0-polished.md'
---

# Product Requirements Document - AI-as-Me v2.0

**Author:** Jody
**Date:** 2026-01-13

## 1. 产品概述

### 1.1 产品愿景
AI-as-Me v2.0 是一个开源的自进化 AI 数字分身系统，专为技术型创业者打造真正能"替你打工"的智能伙伴。

### 1.2 核心价值主张
从"每次都要重新解释"到"AI 真正懂我"，通过自进化循环让数字分身成为你的长期伙伴而非一次性工具。

### 1.3 目标用户
- **主要用户**: 技术型独立 AI 创业者（如 Jody）
- **用户特征**: 需要高效 AI 协作，追求结果可直接使用（>80% 采用率）

## 2. 功能需求

### 2.1 核心功能 (P0)

#### 2.1.1 Agent CLI 编排系统
- **需求**: 集成多个 Agent CLI 工具进行任务编排
- **支持工具**: OpenCode, Claude Code, Gemini CLI, Qwen Code
- **接口**: HTTP API + SSE 支持

#### 2.1.2 任务调度系统
- **CLI 命令**:
  - `ai-as-me task add "description"` - 任务创建
  - `ai-as-me task list --status todo` - 任务管理
  - `ai-as-me serve` - Web 仪表板
  - `ai-as-me agent start` - 主循环启动

#### 2.1.3 Soul 注入系统
- **功能**: 动态能力注入和 BMAD 技能扩展
- **配置**: JSON 配置系统支持多个 Agent CLI 预设
- **模式**: DEFAULT, PLAN, OPUS, APPROVALS

### 2.2 高级功能 (P1)

#### 2.2.1 养蛊反思循环
- **功能**: 自进化机制，持续学习优化
- **组件**: 反思器、规则提取器

#### 2.2.2 Agentic RAG
- **功能**: 经验检索和上下文增强
- **组件**: 向量存储、检索器

### 2.3 扩展功能 (P2)

#### 2.3.1 Web 仪表板增强
- **功能**: 任务提交界面优化
- **优先级**: CLI > Web Dashboard > File System > REST API

## 3. 技术架构

### 3.1 三层架构
1. **AI-as-Me** (调度层) → 
2. **Agent CLI** (执行层) → 
3. **Agentic RAG** (反思层)

### 3.2 文件结构
```
src/ai_as_me/
├── orchestrator/ (agent_cli.py, scheduler.py, soul_injector.py, skill_matcher.py)
├── yangu/ (reflector.py, rule_extractor.py)
├── rag/ (vectorstore.py, retriever.py)
└── kanban/ (database.py, dashboard.py)
```

## 4. 成功指标 (MVP - 个人用户验证)

### 4.1 核心验证指标
- **个人采用率**: >80% (Jody 个人输出内容可直接使用)
- **任务完成质量**: 首次输出满意度 >75%
- **学习效果**: AI 分身对 Jody 个人偏好理解准确度提升
- **工作效率**: Jody 个人重复解释时间减少 >50%

### 4.2 技术验证指标
- **系统稳定性**: 
  - 任务响应时间 <30秒
  - Agent CLI 集成成功率 >95%
  - 养蛊循环正常运行
- **功能完整性**:
  - P0 功能全部可用
  - Soul 注入机制有效
  - BMAD 技能扩展正常

### 4.3 产品验证指标
- **自进化效果**: 
  - AI 分身个性化准确度随使用提升
  - "养蛊"机制通过个人使用验证
- **差异化验证**:
  - 相比现有 AI 工具，减少重复解释 >70%
  - 长期记忆和学习能力得到验证

*注：当前为 MVP 阶段，以 Jody 个人使用验证为主，后续扩展到更广泛用户群体时将调整指标体系。*

## 6. 用户旅程映射 (MVP - Jody 个人验证)

### 6.1 主要用户画像

**Jody - 技术型独立 AI 创业者**
- **背景**: 深度技术背景，独立开发多个 AI 项目
- **现状痛点**: 每次使用 AI 工具都需要重新解释需求和偏好
- **核心需求**: 需要一个真正"懂我"的 AI 伙伴，能持续学习和进化

### 6.2 核心使用旅程

#### 旅程1：初次设置和 Soul 注入
**开场**: Jody 刚完成 AI-as-Me v2.0 安装，准备配置个人 AI 分身

**步骤流程**:
1. 运行 `ai-as-me setup` 进行初始配置
2. 通过 Soul 注入系统导入个人偏好和工作风格
3. 配置 Agent CLI 集成（OpenCode, Claude Code 等）
4. 设置 BMAD 技能扩展包
5. 完成首次"养蛊"基线建立

**关键时刻**: AI 分身成功理解 Jody 的编程风格和项目偏好
**结果**: 个人化 AI 分身就绪，准备开始学习进化

#### 旅程2：日常任务执行和学习循环
**开场**: Jody 需要处理一个复杂的技术任务

**步骤流程**:
1. 使用 `ai-as-me task add "创建新的 API 接口"` 添加任务
2. AI 分身通过 Agent CLI 编排执行任务
3. 利用 Agentic RAG 检索相关历史经验
4. 生成符合 Jody 风格的代码和文档
5. Jody 审查结果，提供反馈
6. 养蛊系统记录反馈，更新个人偏好模型

**关键时刻**: 输出结果 >80% 可直接使用，无需大幅修改
**结果**: AI 分身对 Jody 的理解进一步深化

#### 旅程3：长期进化验证
**开场**: 使用 AI-as-Me 一个月后，Jody 处理类似任务

**步骤流程**:
1. 添加与之前类似的任务
2. AI 分身自动应用之前学到的偏好和模式
3. 生成更精准符合期望的结果
4. Jody 发现重复解释时间显著减少
5. 通过 Web 仪表板查看学习进化轨迹

**关键时刻**: AI 分身展现出明显的个性化学习效果
**结果**: 验证"养蛊"自进化机制的有效性

### 6.3 成功验证点

- **设置阶段**: Soul 注入成功，Agent CLI 集成正常
- **使用阶段**: 任务执行质量满足 >80% 采用率
- **进化阶段**: 长期使用中体现个性化学习效果

## 5. 领域需求分析 (开发者工具编排系统)

### 5.1 编排系统特定约束

#### 5.1.1 外部工具依赖管理
- **npx 工具可用性**: 确保目标环境支持 Node.js 和 npx
- **版本兼容性**: 外部工具版本更新时的向后兼容
- **网络依赖**: npx 首次下载工具时的网络要求
- **权限管理**: 外部工具执行权限和安全沙箱

#### 5.1.2 Soul 注入技术约束
- **提示词长度限制**: 不同 Agent CLI 的 context window 限制
- **格式兼容性**: 各工具对提示词格式的要求差异
- **编码处理**: 中文 Soul 内容的编码传递
- **敏感信息过滤**: 避免在提示词中泄露敏感配置

#### 5.1.3 进程管理复杂性
- **异步执行**: 多个 Agent CLI 并发调用的资源管理
- **超时处理**: 外部工具无响应时的降级策略
- **错误传播**: 外部工具错误信息的标准化处理
- **日志聚合**: 多个工具输出的统一日志管理

### 5.2 MVP 阶段简化策略

#### 5.2.1 工具集合限制
- **初期支持**: 仅集成 Claude Code 和 OpenCode 两个工具
- **串行执行**: 避免并发复杂性，任务串行处理
- **同步调用**: 简化异步处理，直接等待工具完成

#### 5.2.2 Soul 注入简化
- **固定模板**: 使用预定义的提示词模板
- **基础个性化**: 仅注入 profile.md 核心信息
- **手动配置**: 暂不实现自动工具选择，由用户指定

### 5.3 技术风险缓解

#### 5.3.1 外部依赖风险
- **本地缓存**: 缓存常用工具版本，减少网络依赖
- **降级机制**: 主工具失败时切换到备用工具
- **健康检查**: 定期验证外部工具可用性

#### 5.3.2 数据安全
- **本地处理**: Soul 数据仅在本地处理，不上传
- **临时文件清理**: 及时清理包含敏感信息的临时文件
- **API 密钥隔离**: 各工具 API 密钥独立管理
## 8. MVP 范围界定

### 8.1 MVP 核心边界 (4天实施)

#### 8.1.1 必须包含 (MVP 最小可行)
- **基础 Agent CLI 编排**: Claude Code + OpenCode 集成
- **Soul 注入机制**: profile.md 提示词注入
- **任务调度系统**: `ai-as-me task add/list` 命令
- **简单养蛊循环**: 基础反思和规则积累
- **本地文件存储**: 任务状态和 Soul 数据管理

#### 8.1.2 MVP 验证目标
- **个人可用性**: Jody 能够日常使用完成实际任务
- **核心价值验证**: 80% 采用率目标的初步验证
- **技术可行性**: 编排架构的基础实现

### 8.2 功能优先级矩阵

| 功能模块 | MVP (P0) | v2.1 (P1) | v2.2 (P2) | 排除 |
|---------|----------|-----------|-----------|------|
| Agent CLI 编排 | ✓ 2个工具 | 4个工具 | 全部工具 | - |
| Soul 注入 | ✓ 基础模板 | 动态模板 | 智能优化 | - |
| 任务调度 | ✓ 串行执行 | 并行执行 | 智能调度 | - |
| 养蛊循环 | ✓ 简单反思 | 深度学习 | 自动优化 | - |
| Web 仪表板 | - | ✓ 基础界面 | 高级功能 | 复杂图表 |
| Agentic RAG | - | ✓ 基础检索 | 智能推荐 | 复杂推理 |
| BMAD 集成 | - | - | ✓ 技能扩展 | 完整集成 |

### 8.3 MVP 边界决策

#### 8.3.1 包含理由
- **Agent CLI 编排**: 核心差异化价值，必须验证
- **Soul 注入**: 个性化的关键机制，MVP 核心
- **基础养蛊**: 自进化概念验证，长期价值基础

#### 8.3.2 延后理由
- **Web 仪表板**: CLI 优先，界面可后续优化
- **多工具支持**: 先验证 2个工具的编排逻辑
- **高级 RAG**: 基础功能验证后再增强智能化

#### 8.3.3 排除理由
- **复杂图表**: 非核心价值，增加开发复杂度
- **完整 BMAD 集成**: 架构复杂，MVP 阶段风险高

### 8.4 成功标准重新校准

#### 8.4.1 MVP 成功标准
- **技术标准**: 2个 Agent CLI 稳定集成，Soul 注入正常工作
- **用户标准**: Jody 个人使用满意度 >75%，愿意持续使用
- **产品标准**: 核心工作流程完整，基础自进化机制运行

#### 8.4.2 失败快速识别
- **技术失败**: Agent CLI 调用失败率 >20%
- **用户失败**: 连续 3天不使用或满意度 <50%
- **产品失败**: 无法完成基本任务或无学习效果
## 9. 功能需求详细定义

### 9.1 核心编排能力 (P0 - MVP)

#### FR-01: Agent CLI 工具集成
- **能力**: 系统能够调用外部 Agent CLI 工具执行任务
- **具体功能**:
  - 支持 Claude Code (`npx -y @anthropic-ai/claude-code@2.0.76`)
  - 支持 OpenCode (`npx -y opencode-ai@1.1.3`)
  - 工具可用性检测和健康检查
  - 工具调用失败时的错误处理
- **验收标准**: 能够成功调用并获取工具执行结果

#### FR-02: Soul 注入机制
- **能力**: 系统能够将个人化上下文注入到外部工具
- **具体功能**:
  - 读取 `soul/profile.md` 个人档案
  - 读取 `soul/rules.md` 工作规则
  - 构建个性化提示词模板
  - 将 Soul 上下文传递给外部工具
- **验收标准**: 外部工具输出体现个人化特征

#### FR-03: 任务生命周期管理
- **能力**: 系统能够管理任务从创建到完成的全流程
- **具体功能**:
  - `ai-as-me task add "description"` - 创建新任务
  - `ai-as-me task list --status todo` - 查看任务列表
  - 任务状态跟踪 (todo → doing → done)
  - 任务执行历史记录
- **验收标准**: 完整的任务生命周期可追踪

#### FR-04: 基础养蛊循环
- **能力**: 系统能够从执行结果中学习和改进
- **具体功能**:
  - 收集任务执行结果和用户反馈
  - 提取成功/失败模式
  - 更新 `soul/rules.md` 规则文件
  - 为相似任务提供历史经验参考
- **验收标准**: 规则文件随使用逐步丰富

### 9.2 增强功能 (P1 - v2.1)

#### FR-05: 多工具智能选择
- **能力**: 系统能够根据任务特征选择最适合的工具
- **具体功能**:
  - 任务类型识别 (代码、文档、分析等)
  - 工具能力匹配算法
  - 基于历史成功率的工具推荐
  - 用户手动指定工具选项
- **验收标准**: 工具选择准确率 >80%

#### FR-06: Web 仪表板
- **能力**: 提供可视化的任务管理和系统监控界面
- **具体功能**:
  - 任务看板视图 (inbox/todo/doing/done)
  - 实时任务执行状态显示
  - Soul 学习进度可视化
  - 系统健康状态监控
- **验收标准**: 基础 Web 界面可用

#### FR-07: Agentic RAG 检索
- **能力**: 系统能够检索和利用历史经验
- **具体功能**:
  - 任务和结果向量化存储
  - 相似任务检索和推荐
  - 历史成功案例复用
  - 上下文增强的任务执行
- **验收标准**: 检索准确率 >85%

### 9.3 高级功能 (P2 - v2.2)

#### FR-08: BMAD 技能扩展
- **能力**: 当 Soul 能力不足时，动态加载 BMAD 技能包
- **具体功能**:
  - 能力缺口自动检测
  - BMAD 技能包动态加载
  - 多 Agent 协作执行复杂任务
  - 技能学习和固化到 Soul
- **验收标准**: 复杂任务完成率提升 >30%

#### FR-09: 高级调度优化
- **能力**: 智能任务调度和资源优化
- **具体功能**:
  - 任务优先级智能排序
  - 并行任务执行管理
  - 资源使用优化
  - 执行时间预测
- **验收标准**: 整体执行效率提升 >40%

### 9.4 支撑功能 (所有版本)

#### FR-10: 配置管理
- **能力**: 灵活的系统配置和个性化设置
- **具体功能**:
  - Agent CLI 工具配置管理
  - API 密钥安全存储
  - 用户偏好设置
  - 系统参数调优
- **验收标准**: 配置变更即时生效

#### FR-11: 日志和监控
- **能力**: 完整的系统运行日志和监控
- **具体功能**:
  - 任务执行日志记录
  - 系统性能监控
  - 错误日志和告警
  - 使用统计和分析
- **验收标准**: 问题可快速定位和解决
## 10. 非功能需求

### 10.1 性能需求

#### NFR-01: 响应时间
- **Agent CLI 调用**: 单次工具调用响应时间 <30秒
- **任务创建**: CLI 命令响应时间 <2秒
- **Soul 注入**: 提示词构建和注入时间 <5秒
- **Web 界面**: 页面加载时间 <3秒

#### NFR-02: 并发处理
- **MVP 阶段**: 支持串行任务执行，单用户使用
- **v2.1 阶段**: 支持最多 3个并发任务
- **资源限制**: 内存使用 <2GB，CPU 使用率 <80%

### 10.2 可靠性需求

#### NFR-03: 系统可用性
- **目标可用性**: >95% (MVP 阶段个人使用)
- **故障恢复**: 外部工具失败时 <10秒内切换备用方案
- **数据持久性**: Soul 数据和任务历史 100% 持久化
- **自动重启**: 系统异常时自动重启机制

#### NFR-04: 错误处理
- **外部工具失败**: 优雅降级，提供明确错误信息
- **网络异常**: 本地缓存支持，离线模式基础功能
- **配置错误**: 启动时配置验证，错误提示和修复建议

### 10.3 安全需求

#### NFR-05: 数据安全
- **本地存储**: 所有 Soul 数据仅本地存储，不上传云端
- **API 密钥**: 环境变量存储，不在代码中硬编码
- **临时文件**: 包含敏感信息的临时文件及时清理
- **权限控制**: Soul 文件权限 600 (仅用户可读写)

#### NFR-06: 进程安全
- **外部工具隔离**: 外部 Agent CLI 在受限环境中执行
- **输入验证**: 用户输入和外部工具输出的安全验证
- **日志脱敏**: 日志中自动过滤敏感信息

### 10.4 可用性需求

#### NFR-07: 易用性
- **安装简便**: `pip install ai-as-me` 一键安装
- **配置简单**: 5分钟内完成基础配置
- **命令直观**: CLI 命令符合 Unix 惯例，支持 `--help`
- **错误友好**: 错误信息清晰，提供解决建议

#### NFR-08: 文档完整性
- **快速开始**: 15分钟上手指南
- **API 文档**: 完整的 CLI 命令和配置说明
- **故障排除**: 常见问题和解决方案
- **示例丰富**: Soul 配置和使用场景示例

### 10.5 兼容性需求

#### NFR-09: 平台支持
- **操作系统**: Linux (主要), macOS (支持), Windows (基础)
- **Python 版本**: Python 3.9+ 
- **Node.js 依赖**: Node.js 16+ (npx 工具调用)
- **Shell 环境**: Bash, Zsh 命令补全支持

#### NFR-10: 工具兼容性
- **Agent CLI 版本**: 支持指定版本锁定，避免破坏性更新
- **API 接口**: 兼容 OpenAI API 格式的工具
- **配置格式**: 向后兼容的配置文件格式

### 10.6 可维护性需求

#### NFR-11: 代码质量
- **测试覆盖率**: 核心功能测试覆盖率 >80%
- **代码规范**: 遵循 PEP 8 Python 编码规范
- **模块化设计**: 清晰的模块边界，便于扩展
- **日志完整**: 关键操作和错误的完整日志记录

#### NFR-12: 监控和诊断
- **健康检查**: 系统和外部工具健康状态检查
- **性能监控**: 任务执行时间和资源使用监控
- **使用统计**: 功能使用频率和成功率统计
- **问题诊断**: 详细的错误堆栈和上下文信息
