# AI-as-Me v2.2 迭代规划

**Created:** 2026-01-14T08:38:00+08:00
**Author:** BMad Master 🧙
**Status:** Draft

---

## 1. 版本目标

v2.2 聚焦于：
1. **技术债务清理** - 处理 v2.1 Code Review 遗留问题
2. **性能优化** - 提升系统响应速度和稳定性
3. **功能增强** - 扩展工具支持和用户体验

---

## 2. 需求来源

### 2.1 Code Review 遗留 (5项)

| ID | 问题 | 优先级 | 来源 |
|----|------|--------|------|
| CR-M1 | SSE 重连机制 | P1 | code-review-v2.1.md |
| CR-M2 | 关键词预处理优化 | P2 | code-review-v2.1.md |
| CR-M4 | 反馈权重持久化 | P1 | code-review-v2.1.md |
| CR-L1 | 完整类型注解 | P3 | code-review-v2.1.md |
| CR-L3 | 魔法数字注释 | P3 | code-review-v2.1.md |

### 2.2 Retrospective 建议 (3项)

| ID | 建议 | 优先级 | 来源 |
|----|------|--------|------|
| RT-1 | 数据库连接池 | P2 | retrospective-v2.1.md |
| RT-2 | 更多 Agent CLI 工具 | P2 | retrospective-v2.1.md |
| RT-3 | Web 界面美化 | P3 | retrospective-v2.1.md |

### 2.3 PRD P2 功能 (1项)

| ID | 功能 | 优先级 | 来源 |
|----|------|--------|------|
| FR-08 | BMAD 技能扩展 | P2 | prd-v2.0.md |

---

## 3. 功能需求详细定义

### FR-08: BMAD 技能扩展

**描述:** 当 Soul 能力不足时，动态加载 BMAD 技能包

**子功能:**
- 能力缺口自动检测
- BMAD 技能包动态加载
- 多 Agent 协作执行
- 技能学习和固化到 Soul

**验收标准:**
- 复杂任务完成率提升 >30%

---

### FR-09: SSE 重连与稳定性

**描述:** 前端 SSE 连接断开后自动重连

**子功能:**
- 前端自动重连机制
- 指数退避重试
- 连接状态指示器

**验收标准:**
- 网络断开后 5秒内自动重连
- 用户可见连接状态

---

### FR-10: 反馈学习持久化

**描述:** 用户反馈权重持久化到数据库

**子功能:**
- 反馈权重存储到 SQLite
- 重启后恢复权重
- 权重衰减机制

**验收标准:**
- 重启后反馈权重保留
- 检索结果体现权重影响

---

## 4. Epic 规划

### Epic 8: 技术债务清理

| Story | 名称 | 优先级 | 来源 |
|-------|------|--------|------|
| 8.1 | SSE 前端重连机制 | P1 | CR-M1 |
| 8.2 | 反馈权重持久化 | P1 | CR-M4 |
| 8.3 | 关键词预处理优化 | P2 | CR-M2 |
| 8.4 | 类型注解完善 | P3 | CR-L1 |

**预估:** 2天

---

### Epic 9: 性能优化

| Story | 名称 | 优先级 | 来源 |
|-------|------|--------|------|
| 9.1 | 数据库连接池 | P2 | RT-1 |
| 9.2 | RAG 检索缓存 | P2 | 新增 |
| 9.3 | 嵌入模型预加载 | P2 | 新增 |

**预估:** 2天

---

### Epic 10: 功能增强 (可选)

| Story | 名称 | 优先级 | 来源 |
|-------|------|--------|------|
| 10.1 | 新增 Gemini CLI 支持 | P2 | RT-2 |
| 10.2 | 新增 Qwen Code 支持 | P2 | RT-2 |
| 10.3 | Web 界面美化 | P3 | RT-3 |
| 10.4 | BMAD 技能扩展 | P2 | FR-08 |

**预估:** 3天

---

## 5. 优先级矩阵

| 优先级 | Stories | 说明 |
|--------|---------|------|
| **P1 必须** | 8.1, 8.2 | 技术债务核心 |
| **P2 应该** | 8.3, 9.1, 9.2, 9.3, 10.1, 10.2, 10.4 | 性能和功能 |
| **P3 可选** | 8.4, 10.3 | 代码质量和美化 |

---

## 6. 实施计划

### MVP 范围 (4天)

```
Day 1-2: Epic 8 (技术债务)
├── 8.1 SSE 重连
├── 8.2 反馈持久化
└── 8.3 关键词优化

Day 3-4: Epic 9 (性能优化)
├── 9.1 连接池
├── 9.2 RAG 缓存
└── 9.3 模型预加载
```

### 扩展范围 (+3天)

```
Day 5-7: Epic 10 (功能增强)
├── 10.1 Gemini CLI
├── 10.2 Qwen Code
└── 10.4 BMAD 扩展
```

---

## 7. 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| SSE 重连复杂 | 中 | 使用成熟库 (reconnecting-eventsource) |
| 连接池引入复杂度 | 低 | 使用 SQLAlchemy 连接池 |
| BMAD 集成复杂 | 高 | 延后到 v2.3 如时间不足 |

---

## 8. 成功指标

| 指标 | 目标 |
|------|------|
| 技术债务清理 | 100% P1 完成 |
| 性能提升 | API 响应 <500ms |
| 测试覆盖 | 保持 >90% |
| 用户满意度 | SSE 稳定性提升 |

---

## 9. 下一步

1. **确认范围** - 选择 MVP 或扩展范围
2. **创建 Epics** - 运行 create-epics-and-stories
3. **Sprint Planning** - 规划 v2.2 Sprint

---

**请选择 v2.2 范围:**

1. **MVP (4天)** - Epic 8 + Epic 9
2. **扩展 (7天)** - Epic 8 + Epic 9 + Epic 10
3. **自定义** - 选择特定 Stories
